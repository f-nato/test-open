\chapter{計算機実験による再構成シミュレーション}
Tikhonov-Phillips正則化および最小Fisher情報量法による再構成を，人工の想定分布(ファントム)を用いてテストする。一連の処理における途中経過を図\ref{fig:reconst}に示し，以降各段階を説明する。
\begin{figure}[H]
	 \centering
	 \includegraphics[scale=0.15]{fig/reconst.png}
	 \caption{計算機実験の各段階における出力;(1)ファントム(2)投影図(3)ノイズ付投影図(4)フィルタリングされた投影図(5)再構成結果}
	 \label{fig:reconst}
\end{figure}
\begin{itemize}
	\item [(1)]実際のX線発光を想定したファントムを作成する。画像下側軸は$R=0$を表し，TS-6内部の中心対称軸の位置と一致する。紙面垂直方向にガイド磁場が印加され$Z+, Z-$に生じた２つのプラズマが互いに接近し$Z=0$付近で合体した結果，範囲の大きなダウンストリーム加熱と小さなX点加熱が生じることを想定している。
	\item [(2)]ファントムが軸対称に広がっていると仮定して，MCPに入射するX線の強度を視線積分した上で投影図を作成する。カメラが撮影する光はMCP後段のファイバーバンドルが送信するため，画像は円形に制限される。
	\item [(3)]画素の値を正規化した上で，(2)の投影図にノイズを印加する。ノイズはカメラのショットノイズを想定し，$S/N = 10\mathrm{dB}$の加法性ホワイトガウスノイズとした。この画像が式\ref{eq;s=le}中$S$であり，実際のTS実験でもカメラが撮影する画像である。
	\item [(4)](3)の投影図にフィルタリングを行う。
	\item [(5)](4)で得た画像から式\ref{eq;lambda}に示す$\Lambda$が最も小さくなるような画像を解として再構成する。
\end{itemize}
\section{想定分布と投影図}
実際のプラズマには(i)ダウンストリーム加熱による範囲が広く強度の大きなピークの近傍に(ii)範囲が狭く強度の小さいX点加熱のピークが生じることが予測されており，(i)(ii)それぞれを正確に復元することが再構成ソフトウェアに求められる。
まず図\ref{fig:assumption}左の通り(i)(ii)の半値全幅をそれぞれ$r_1 = 23.9\mathrm{cm}, r_2 = 3.5\mathrm{cm}$, ピーク間距離を$d = 10.5\mathrm{cm}$に設定し，ピーク領域とオフピーク領域を以下の同図中央に示す通り定める。
同図右は式(\ref{eq;s=le})の重み行列$L$を表すピンホールカメラの視線分布で，ポロイダル面に仮定したファントムが三次元空間では軸対称に広がっていることを仮定すればノイズを含まない観測画像$S = LE$が計算される。一視線が欠損や外れ値となった場合，再構成像にはこの曲線に沿ってアーチファクトが生じることになる。
\begin{figure}[H]
	\centering
	\includegraphics[scale=0.4]{fig/assumption.png}
	\caption{作成した想定分布$d = 10\mathrm{cm}$（左）とこれに対するピーク領域，オフピーク領域の範囲（中央），カメラ視線の二次元分布(右)}
	\label{fig:assumption}
\end{figure}

\section{投影図に対するフィルタ処理}
ノイズの無い理論上の観測画像$S$に対してそれぞれのピークが投影された部分を示したものが図\ref{fig:projection}左である。トーラス中心部の軸によって視線の一部が遮られ，投影図下部に影が生じることが確認できた。
X線がMCPを通じて電子線に変換され，さらに蛍光板で可視光に変換されてからカメラに撮影されるまでの間にはショットノイズ等の統計的誤差が含まれることが想定されるため，実際に得られる観測画像として理論上の観測画像に$S/N = 10\mathrm{dB}$のガウスノイズを印加したものが同図中央，さらにこの画像にNLMを適用したものが同図右である。理論画像に対する枠内部の構造類似度(SSIM)がそれぞれ示してあり，フィルタによってこれらの値が大幅に改善することが分かる。
\begin{figure}[H]
	 \centering
	 \includegraphics[scale=0.5]{fig/projection.png}
	 \caption{観測画像の理論値（左）とガウスノイズ付加後の観測画像（中央），ノイズ付加後にNLMを適用した観測画像（右）. 枠下の数値は理論値に対する枠内の構造類似度.}
	 \label{fig:projection}
\end{figure}
ここでNLMによってノイズと小ピークの像が判別され，ノイズのみが選択的に低減された事実を検証するために，投影図中の大ピークと小ピークを含む一次元でフーリエ変換を施す。断面分布におけるピーク距離$d$をパラメタとした結果が図\ref{fig:filter_fft}で，ノイズなし投影図のスペクトルと$d=10.5cm$に対してノイズとNLMを適用した際のスペクトル，NLMによる変動分の理論画像に対する割合が示されている。$d$の変化によって波数$10\mathrm{/24.8cm}$以下の低周波におけるピークがシフトするため，ここをピークの分離を表す特徴的な波数帯とすると，ノイズが大きく低減された$10\mathrm{/24.8cm}$以降の領域とはほとんど重ならない。このことからNLMは二つのピークが分離するために必要な波数帯に影響を与えず，小さなピークをスムージングしなかったと捉えられる。
\begin{figure}[H]
	 \centering
	 \includegraphics[scale=0.9]{fig/filter_fft.png}
	 \caption{投影図の一次元フーリエ変換. ３本の青線はそれぞれピーク距離$d$を変えた理論画像の変換を表し，赤線は$d=10.5cm$に対してガウスノイズを付加した画像の変換，黄線はこれにNLMを適用した画像の変換をそれぞれ表す。}
	 \label{fig:filter_fft}
\end{figure}
つぎに小ピークの幅$r_1$をパラメタとした結果が図\ref{fig:filter_fft_r}である。$r_1$の減少に伴って$r_2$が支配的となるためにスペクトルが平坦に近づき，図\ref{fig:filter_fft}に見られた分離を表す波数帯のピークは弱くなっている。このことから小ピークそのものを表現する特徴的な波数帯も$10\mathrm{/24.8cm}$以下であると考えられ，NLMの効果が顕著となる波数$15\mathrm{/24.8cm}$以降との分離が確認できる。
\begin{figure}[H]
	 \centering
	 \includegraphics[scale=0.8]{fig/filter_fft_r.png}
	 \caption{投影図の一次元フーリエ変換. ３本の青線はそれぞれ$r_1$を変えた理論画像の変換を表し，赤線は$r=3.5cm$に対してガウスノイズを付加した画像の変換，黄線はこれにNLMを適用した画像の変換をそれぞれ表す。}
	 \label{fig:filter_fft_r}
\end{figure}
\section{線形再構成と非線形再構成}
Tikhonov-Phillips正則化と最小Fisher情報量法を比較するために，等しい正則化パラメータ$\lambda$を用いてファントムを再構成した結果が図\ref{fig:result_n_nl10}である。オフピーク領域における各画素のMSEは線形手法を使用した場合$1.8\times 10^{-3}$であるのに対して非線形手法を使用した場合は$1.3\times 10^{-3}$と73\%にまで改善し，偽ピークを抑制していることが分かる。同じ正則化パラメータを使用しているから，この結果には式\ref{eq;lambda}第一項$\gamma P(f)$が最小となる像，言い換えれば理想とする像の，ペナルティ関数による違いが現れたと言える。
\begin{figure}[H]
	 \centering
	 \includegraphics[scale=0.5]{fig/result_n_nl.png}
	 \caption{ピーク間隔$10\mathrm{cm}$における線形（左）と非線形（右）再構成結果}
	 \label{fig:result_n_nl10}
\end{figure}

\section{前処理付き非線形再構成}
ノイズが生じた投影図に対して，それぞれ別々に単純平均フィルタ処理とNLMフィルタ処理を施し最小Fisher情報量法で再構成した結果が図\ref{fig:result_filter}である。ピーク領域における，NLMフィルタを適用した画像の再構成誤差はフィルタなしと比較して$50\%$にまで向上した。非線形フィルタ処理では大ピークがなめらかに正則化され，かつ小ピークがフィルタによって鮮鋭化されたことで目視でもはっきりと区別できる画像が得られている。
このことから，フィルタと非線形再構成を組み合わせる手法が小さなピークとノイズを分離し，かつ大ピークの歪みによる偽のピークを低減することが分かる。
\begin{figure}[H]
	 \centering
	 \includegraphics[scale=0.6]{fig/result_filter.png}
	 \caption{$10\%$ノイズ付投影図に対して，フィルタなし（左），線形フィルタ（中央），NLMフィルタ（右）を用いて非線形再構成した結果}
	 \label{fig:result_filter}
\end{figure}
